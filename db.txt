CREATE DATABASE QLMS;
USE QLMS;

create table Roles
(
    id   int auto_increment not null primary key,
    name varchar(30)        not null
);

insert into Roles (id, name) VALUES (1, 'USER');
insert into Roles (id, name) values (2, 'ADMIN');

create table Users
(
    id                        int auto_increment not null primary key,
    email                     varchar(30)        not null unique,
    username                  varchar(20)        not null unique,
    first_name                nvarchar(20)       not null,
    last_name                 nvarchar(20)       not null,
    password_hash             varchar(255)       not null,
    password_reset_hash       varchar(64)        null     default null unique,
    password_reset_expired_at datetime           null     default null,
    activation_hash           varchar(64)        null     default null,
    is_active                 boolean            null     default null,
    roleId                    int                not null default 1,
    foreign key (roleId) references Roles (id),
    created_at                datetime                    default now(),
    updated_at                datetime                    default now(),
    deleted_at                datetime                    default now()
);

create table Remembered_logins
(
    token_hash varchar(64) not null,
    user_id    int         not null,
    expired_at datetime    not null,
    foreign key (user_id) references Users (id)
);

create table Books (
    id int not null auto_increment primary key ,
    name nvarchar(350) not null ,
    description text ,
    overview text,
    price int not null ,
    banner_link varchar(500)
);

create table BookDetails (
    id int not null auto_increment primary key ,
    book_id int not null ,
    page_link varchar(200) not null ,
    foreign key (book_id) references Books(id)
);

create table Carts (
    id int auto_increment not null primary key,
    user_id int not null,
    foreign key (user_id) references Users(id),
    created_at datetime default now(),
    updated_at datetime default now()
);

create table CartItems (
    id int auto_increment not null  primary key,
    cart_id int not null,
    book_id int not null,
    foreign key (cart_id) references Carts(id),
    foreign key (book_id) references Books(id),
    created_at                datetime                    default now(),
    updated_at                datetime                    default now(),
    deleted_at                datetime                    default now()
);

drop table Remembered_logins;
drop table Users;

drop table CartItems;
drop table Carts;

select * from Users;
select * from Remembered_logins
select * from Carts;
select * from CartItems;
select * from Books;
select * from Roles;
delete from Books;
select * from BookDetails;
